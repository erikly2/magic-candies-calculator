<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magic Candies Calculator</title>
    <script>
      const candiesRequired = {
        10: 100,
        20: 300,
        30: 600,
      };

      const materialsRequired = {
        10: { sugarCrystals: 50, soulEssence: 20 },
        20: { sugarCrystals: 150, soulEssence: 60 },
        30: { sugarCrystals: 300, soulEssence: 120 },
      };

      let cookieData = {};
      let globalMaterials = {
        sugarCrystals: [0, 0, 0],
        soulEssence: [0, 0, 0, 0],
      };

      function updateGlobalMaterials() {
        globalMaterials.sugarCrystals = [
          parseInt(document.getElementById("globalSugarCrystals1").value) || 0,
          parseInt(document.getElementById("globalSugarCrystals2").value) || 0,
          parseInt(document.getElementById("globalSugarCrystals3").value) || 0,
        ];
        globalMaterials.soulEssence = [
          parseInt(document.getElementById("globalSoulEssence1").value) || 0,
          parseInt(document.getElementById("globalSoulEssence2").value) || 0,
          parseInt(document.getElementById("globalSoulEssence3").value) || 0,
          parseInt(document.getElementById("globalSoulEssence4").value) || 0,
        ];
      }

      function calculateCandies(cookie) {
        const currentLevel =
          parseInt(document.getElementById(`currentLevel_${cookie}`).value) ||
          0;
        const targetLevel =
          parseInt(document.getElementById(`targetLevel_${cookie}`).value) || 0;
        const currentCandies =
          parseInt(document.getElementById(`currentCandies_${cookie}`).value) ||
          0;

        if (currentLevel >= targetLevel) {
          document.getElementById(
            `result_${cookie}`
          ).innerText = `You have already reached or exceeded level +${targetLevel}.`;
          return;
        }

        const candiesNeeded =
          (candiesRequired[targetLevel] || 0) -
          (candiesRequired[currentLevel] || 0) -
          currentCandies;
        const sugarCrystalsNeeded =
          (materialsRequired[targetLevel]?.sugarCrystals || 0) -
          (materialsRequired[currentLevel]?.sugarCrystals || 0);
        const soulEssenceNeeded =
          (materialsRequired[targetLevel]?.soulEssence || 0) -
          (materialsRequired[currentLevel]?.soulEssence || 0);

        const remainingSugarCrystals =
          globalMaterials.sugarCrystals.reduce((acc, curr) => acc + curr, 0) -
          sugarCrystalsNeeded;
        const remainingSoulEssence =
          globalMaterials.soulEssence.reduce((acc, curr) => acc + curr, 0) -
          soulEssenceNeeded;

        document.getElementById(`result_${cookie}`).innerHTML = `
                You need ${
                  candiesNeeded > 0 ? candiesNeeded : 0
                } more magic candies.<br>
                You need ${
                  sugarCrystalsNeeded > 0 ? sugarCrystalsNeeded : 0
                } more Sugar Crystals (Remaining: ${remainingSugarCrystals}).<br>
                You need ${
                  soulEssenceNeeded > 0 ? soulEssenceNeeded : 0
                } more Soul Essence (Remaining: ${remainingSoulEssence}).
            `;
      }

      function updateLevel(cookie, change) {
        let targetLevel =
          parseInt(document.getElementById(`targetLevel_${cookie}`).value) ||
          cookieData[cookie].currentLevel;
        const newLevel = targetLevel + change;

        if (newLevel >= cookieData[cookie].currentLevel && newLevel <= 30) {
          document.getElementById(`targetLevel_${cookie}`).value = newLevel;
          document.getElementById(`decreaseLevel_${cookie}`).disabled =
            newLevel === cookieData[cookie].currentLevel;
          cookieData[cookie].targetLevel = newLevel;
        }
      }

      function syncTargetWithCurrent(cookie) {
        const currentLevel =
          parseInt(document.getElementById(`currentLevel_${cookie}`).value) ||
          0;
        document.getElementById(`targetLevel_${cookie}`).value = currentLevel;
        document.getElementById(`decreaseLevel_${cookie}`).disabled = true;
        cookieData[cookie].currentLevel = currentLevel;
        cookieData[cookie].targetLevel = currentLevel;
      }

      function showCookie(cookie) {
        document
          .querySelectorAll(".cookie-panel")
          .forEach((panel) => (panel.style.display = "none"));
        document.getElementById(`cookie_${cookie}`).style.display = "block";
      }
    </script>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: row;
      }
      .sidebar {
        width: 200px;
        background: #f4f4f4;
        padding: 10px;
        height: 100vh;
        overflow-y: auto;
      }
      .sidebar button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 5px;
        border: none;
        background: #ddd;
        cursor: pointer;
      }
      .sidebar button:hover {
        background: #bbb;
      }
      .content {
        flex-grow: 1;
        padding: 20px;
      }
      .cookie-panel {
        display: none;
      }
      .level-controls button:disabled {
        background-color: grey;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h3>Cookies</h3>
      <script>
        for (let i = 1; i <= 31; i++) {
          cookieData[`cookie${i}`] = {
            currentLevel: 0,
            targetLevel: 0,
            candies: 0,
          };
          document.write(
            `<button onclick="showCookie('cookie${i}')">Cookie ${i}</button>`
          );
        }
      </script>
    </div>

    <div class="content">
      <h1>Magic Candies Calculator</h1>
      <div>
        <label for="globalSugarCrystals1">Sugar Crystals 1:</label>
        <input
          type="number"
          id="globalSugarCrystals1"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>
      <div>
        <label for="globalSugarCrystals2">Sugar Crystals 2:</label>
        <input
          type="number"
          id="globalSugarCrystals2"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>
      <div>
        <label for="globalSugarCrystals3">Sugar Crystals 3:</label>
        <input
          type="number"
          id="globalSugarCrystals3"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>

      <div>
        <label for="globalSoulEssence1">Soul Essence 1:</label>
        <input
          type="number"
          id="globalSoulEssence1"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>
      <div>
        <label for="globalSoulEssence2">Soul Essence 2:</label>
        <input
          type="number"
          id="globalSoulEssence2"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>
      <div>
        <label for="globalSoulEssence3">Soul Essence 3:</label>
        <input
          type="number"
          id="globalSoulEssence3"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>
      <div>
        <label for="globalSoulEssence4">Soul Essence 4:</label>
        <input
          type="number"
          id="globalSoulEssence4"
          min="0"
          value="0"
          onchange="updateGlobalMaterials()"
        />
      </div>

      <div id="cookie_panels">
        <script>
          for (let i = 1; i <= 31; i++) {
            document.write(`
                        <div id="cookie_cookie${i}" class="cookie-panel">
                            <h2>Cookie ${i}</h2>
                            <label for="currentLevel_cookie${i}">Current Level:</label>
                            <input type="number" id="currentLevel_cookie${i}" min="0" max="30" value="0" onchange="syncTargetWithCurrent('cookie${i}')">
                            <label for="currentCandies_cookie${i}">Current Candies:</label>
                            <input type="number" id="currentCandies_cookie${i}" min="0" value="0">
                            <label for="targetLevel_cookie${i}">Target Level:</label>
                            <button class="level-controls" id="decreaseLevel_cookie${i}" onclick="updateLevel('cookie${i}', -1)" disabled>-</button>
                            <input type="number" id="targetLevel_cookie${i}" min="0" max="30" value="0" readonly>
                            <button class="level-controls" onclick="updateLevel('cookie${i}', 1)">+</button>
                            <p><button onclick="calculateCandies('cookie${i}')">Calculate</button></p>
                            <div id="result_cookie${i}"></div>
                        </div>
                    `);
          }
        </script>
      </div>
    </div>
  </body>
</html>
